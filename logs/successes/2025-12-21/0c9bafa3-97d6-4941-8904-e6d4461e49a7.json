{
  "log_id": "0c9bafa3-97d6-4941-8904-e6d4461e49a7",
  "session_id": "0c9bafa3-97d6-4941-8904-e6d4461e49a7",
  "timestamp": "2025-12-21T09:32:34.031230",
  "status": "success",
  "code": "# Last Code Update - 09:32:24\r\nimport os\r\nimport MapsBridge\r\nimport cv2\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\n\r\ndef main():\r\n    # 1. Read tile set request\r\n    request = MapsBridge.ScriptTileSetRequest.FromStdIn()\r\n    sourceTileSet = request.SourceTileSet\r\n    \r\n    # 2. Get the first tile to process and its path\r\n    # ðŸš¨ CRITICAL: Channel index keys are strings: \"0\", \"1\", ...\r\n    try:\r\n        tile, tileInfo, input_path = MapsBridge.ResolveSingleTileAndPath(request, \"0\")\r\n        MapsBridge.LogInfo(f\"Processing tile [{tile.Column}, {tile.Row}] from: {input_path}\")\r\n    except Exception as e:\r\n        MapsBridge.LogError(f\"Failed to resolve single tile or get input path: {e}\")\r\n        return\r\n\r\n    # 3. Process image\r\n    try:\r\n        # Read the image using OpenCV\r\n        img_bgr = cv2.imread(input_path)\r\n        if img_bgr is None:\r\n            MapsBridge.LogError(f\"Failed to read image file: {input_path}\")\r\n            return\r\n\r\n        # Convert BGR to grayscale\r\n        img_gray = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2GRAY)\r\n\r\n        # Apply a colormap (e.g., 'viridis')\r\n        # Matplotlib colormaps return RGB. We need to convert it back to BGR for OpenCV.\r\n        # Normalize grayscale image to 0-1 range for matplotlib colormap\r\n        img_gray_normalized = img_gray.astype(np.float32) / 255.0\r\n        \r\n        # Apply colormap from matplotlib\r\n        cmap = plt.get_cmap('viridis')\r\n        img_colored_rgb = cmap(img_gray_normalized)[:, :, :3]  # Take only RGB channels\r\n\r\n        # Convert RGB to BGR for OpenCV writing\r\n        img_colored_bgr = cv2.cvtColor((img_colored_rgb * 255).astype(np.uint8), cv2.COLOR_RGB2BGR)\r\n\r\n        # Save the processed image to a temporary folder\r\n        output_folder = MapsBridge.GetTempOutputFolder(\"false_color_outputs\")\r\n        output_filename = f\"tile_{tile.Column}_{tile.Row}_false_color.tif\"\r\n        output_path = os.path.join(output_folder, output_filename)\r\n        \r\n        cv2.imwrite(output_path, img_colored_bgr)\r\n        MapsBridge.LogInfo(f\"Saved processed image to: {output_path}\")\r\n\r\n    except Exception as e:\r\n        MapsBridge.LogError(f\"Error during image processing: {e}\")\r\n        return\r\n\r\n    # 4. Create/get output tile set and ensure channel exists\r\n    try:\r\n        outputInfo = MapsBridge.GetDefaultOutputTileSetAndChannel(\r\n            sourceTileSet=sourceTileSet,\r\n            channelName=\"False Color\",\r\n            channelColor=(0, 255, 255),  # Cyan color for the channel\r\n            isAdditive=True,\r\n            targetLayerGroupName=\"False Color Outputs\",\r\n        )\r\n        MapsBridge.LogInfo(f\"Output TileSet created/retrieved with GUID: {outputInfo.TileSet.Guid}\")\r\n    except Exception as e:\r\n        MapsBridge.LogError(f\"Failed to create/get output TileSet or Channel: {e}\")\r\n        return\r\n\r\n    # 5. Send output tile\r\n    try:\r\n        MapsBridge.SendSingleTileOutput(\r\n            tileRow=tileInfo.Row,\r\n            tileColumn=tileInfo.Column,\r\n            targetChannelName=\"False Color\",\r\n            imageFilePath=output_path,\r\n            keepFile=True,  # Keep the temporary file\r\n            targetTileSetGuid=outputInfo.TileSet.Guid,\r\n        )\r\n        MapsBridge.LogInfo(\"Single tile output sent successfully.\")\r\n    except Exception as e:\r\n        MapsBridge.LogError(f\"Failed to send single tile output: {e}\")\r\n        return\r\n\r\n    MapsBridge.LogInfo(\"Processing complete for tile!\")\r\n\r\nif __name__ == \"__main__\":\r\n    main()",
  "code_hash": "0cd35361b645817e",
  "user_prompt": null,
  "ai_model": null,
  "image_filename": "image.jpg",
  "error_message": null,
  "error_type": null,
  "stderr": null,
  "stdout": "============================================================\n[DEBUG] job_runner.py starting...\n[DEBUG] Python version: 3.11.14 (main, Dec  8 2025, 23:39:47) [GCC 14.2.0]\n[DEBUG] Working directory: /work\n[DEBUG] PYTHONPATH: /work\n============================================================\n[DEBUG] Checking /output directory...\n[DEBUG] /output exists\n[DEBUG] Contents of /output BEFORE script execution:\n[DEBUG]   - .matplotlib (is_file=False)\n[DEBUG] Contents of /input:\n[DEBUG]   - image.jpg (is_file=True)\n[DEBUG] Importing skimage and matplotlib...\n[DEBUG] Imports complete\n[DEBUG] Checking MapsBridge availability...\n[DEBUG] MapsBridge imported successfully from: /work/MapsBridge.py\n[DEBUG] main() starting...\n[DEBUG] Found code file: /code/main.py\n[DEBUG] Code to execute (3393 chars):\n----------------------------------------\n[DEBUG]   1: # Last Code Update - 09:32:24\n[DEBUG]   2: import os\n[DEBUG]   3: import MapsBridge\n[DEBUG]   4: import cv2\n[DEBUG]   5: import numpy as np\n[DEBUG]   6: import matplotlib.pyplot as plt\n[DEBUG]   7: \n[DEBUG]   8: def main():\n[DEBUG]   9:     # 1. Read tile set request\n[DEBUG]  10:     request = MapsBridge.ScriptTileSetRequest.FromStdIn()\n[DEBUG]  11:     sourceTileSet = request.SourceTileSet\n[DEBUG]  12:     \n[DEBUG]  13:     # 2. Get the first tile to process and its path\n[DEBUG]  14:     # ðŸš¨ CRITICAL: Channel index keys are strings: \"0\", \"1\", ...\n[DEBUG]  15:     try:\n[DEBUG]  16:         tile, tileInfo, input_path = MapsBridge.ResolveSingleTileAndPath(request, \"0\")\n[DEBUG]  17:         MapsBridge.LogInfo(f\"Processing tile [{tile.Column}, {tile.Row}] from: {input_path}\")\n[DEBUG]  18:     except Exception as e:\n[DEBUG]  19:         MapsBridge.LogError(f\"Failed to resolve single tile or get input path: {e}\")\n[DEBUG]  20:         return\n[DEBUG] ... (69 more lines)\n----------------------------------------\n[DEBUG] Executing user code...\n[DEBUG] __name__ set to: __main__\n[MapsBridge DEBUG] ScriptTileSetRequest.FromStdIn() called\n[MapsBridge DEBUG] Input directory: /input, exists: True\n[MapsBridge DEBUG] Total image files found: 1\n[MapsBridge DEBUG] Extracted image metadata: 1024x496, format=Bgr24\n[MapsBridge DEBUG] Created ScriptTileSetRequest with 1 tiles\n[INFO] Processing tile [1, 1] from: /input/image.jpg\n[INFO] Saved processed image to: /tmp/false_color_outputs/tile_1_1_false_color.tif\n[INFO] Created output tile set: Results for LocalTestTileSet (Guid: {60EE10BC-1EF8-4252-B9BD-A89D0E1B9E1C})\n[INFO] Created channel: False Color with color (0, 255, 255)\n[INFO] Output TileSet created/retrieved with GUID: {60EE10BC-1EF8-4252-B9BD-A89D0E1B9E1C}\n[MapsBridge DEBUG] SendSingleTileOutput() called:\n[MapsBridge DEBUG]   tileRow=1, tileColumn=1\n[MapsBridge DEBUG]   targetChannelName='False Color'\n[MapsBridge DEBUG]   imageFilePath='/tmp/false_color_outputs/tile_1_1_false_color.tif'\n[INFO] Output saved: False_Color_tile_1_1_false_color.tif (Channel: False Color, Tile: [1, 1])\n[INFO] Single tile output sent successfully.\n[INFO] Processing complete for tile!\n[DEBUG] User code execution completed successfully\n[DEBUG] Contents of /output AFTER script execution:\n[DEBUG]   - .matplotlib/ (directory)\n[DEBUG]   - False_Color_tile_1_1_false_color.tif (857918 bytes)\n[DEBUG] job_runner.py finished\n",
  "return_code": null,
  "output_files": [
    "False_Color_tile_1_1_false_color.tif"
  ],
  "execution_time_seconds": 2.181471347808838,
  "previous_attempt_id": null,
  "fixed_by": null,
  "error_category": null,
  "tags": [
    "lib:MapsBridge",
    "lib:numpy",
    "lib:matplotlib",
    "lib:cv2",
    "request_type:tileset",
    "output:tile"
  ]
}